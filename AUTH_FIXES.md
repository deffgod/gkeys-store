# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ª–æ–≥–∏–Ω–∞ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Session Middleware - –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Session middleware –ø—ã—Ç–∞–ª—Å—è —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é –≤ –ë–î –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ Prisma –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ `PrismaClientKnownRequestError: P1001`
- –≠—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã, –≤–∫–ª—é—á–∞—è –ª–æ–≥–∏–Ω

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (!prisma)` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î —Å graceful degradation
- Middleware –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î

**–§–∞–π–ª**: `backend/src/middleware/session.middleware.ts`

---

### 2. API Client - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ (HTTP 500, 405) API client –ø—ã—Ç–∞–ª—Å—è –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –∫–∞–∫ JSON
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–ª HTML error page, —ç—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞
- –û—à–∏–±–∫–∞ "An error occurred" –Ω–µ –¥–∞–≤–∞–ª–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ

**–†–µ—à–µ–Ω–∏–µ**:
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Content-Type
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞ –∫–∞–∫ JSON
- –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–§–∞–π–ª**: `src/services/api.ts`

---

### 3. Vercel Serverless Handler - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ URL

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Vercel –ø–µ—Ä–µ–¥–∞–µ—Ç –ø—É—Ç—å —á–µ—Ä–µ–∑ `req.url` –∏–ª–∏ `req.path`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Ç–∏ –º–æ–≥–ª–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ HTTP 405 (Method Not Allowed)
- Express app –Ω–µ –ø–æ–ª—É—á–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ**:
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ URL —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–ª–µ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `/api` –∫ –ø—É—Ç–∏
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Ç–æ–¥–∞ –∑–∞–ø—Ä–æ—Å–∞ —è–≤–Ω–æ

**–§–∞–π–ª**: `api/index.ts`

---

### 4. Auth API - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞**:
- Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{ success: true, data: AuthResponse }`
- Frontend –æ–∂–∏–¥–∞–ª –ø—Ä—è–º–æ–π `AuthResponse`
- –≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ `response.token`

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `success` wrapper
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä—è–º—ã–º –æ—Ç–≤–µ—Ç–æ–º

**–§–∞–π–ª**: `src/services/authApi.ts`

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
- `backend/src/middleware/session.middleware.ts` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î
- `src/services/api.ts` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ HTTP
- `api/index.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ URL –≤ Vercel
- `src/services/authApi.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ—è—Ç—Å—è –Ω–∞ Vercel
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–Ω** - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ–π—Ç–∏ —Å–Ω–æ–≤–∞
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Vercel

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint

```bash
curl https://your-project.vercel.app/api/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "ok" or "degraded",
  "checks": {
    "database": "ok" or "error",
    "redis": "ok" or "disconnected",
    "g2a": "ok" or "error"
  }
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞

```bash
curl -X POST https://your-project.vercel.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "data": {
    "user": { ... },
    "token": "...",
    "refreshToken": "...",
    "expiresIn": 604800
  }
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab - –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200 OK

---

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Environment Variables –≤ Vercel:

1. **Database**:
   - `DATABASE_URL` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π connection string
   - `DIRECT_URL` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π direct connection

2. **Authentication**:
   - `JWT_SECRET` - –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
   - `JWT_REFRESH_SECRET` - –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞

3. **G2A** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   - `G2A_API_KEY`
   - `G2A_API_HASH`
   - `G2A_API_URL`
   - `G2A_ENV`

4. **Frontend**:
   - `VITE_API_BASE_URL` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://your-project.vercel.app/api`

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Vercel Dashboard ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí Deployments
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π deployment
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Function Logs –¥–ª—è `/api/*` –∑–∞–ø—Ä–æ—Å–æ–≤
4. –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å:
   - Database connection
   - G2A credentials
   - Session creation

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **Graceful Degradation**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î –∏–ª–∏ Redis (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏)
- **Error Messages**: –û—à–∏–±–∫–∏ —Ç–µ–ø–µ—Ä—å –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã –∏ –ø–æ–º–æ–≥–∞—é—Ç –≤ –æ—Ç–ª–∞–¥–∫–µ
- **URL Handling**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Ç–µ–π –≤ Vercel serverless functions

